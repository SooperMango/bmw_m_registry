<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BMW M Registry</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* Modern Scrollbar */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: #0a0a0a; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideInRight { from { transform: translateX(100%); } to { transform: translateX(0); } }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        .animate-slide-in-right { animation: slideInRight 0.3s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }

        /* Glassmorphism & Base Styles */
        body {
            background-color: #0a0a0a;
            color: #e5e5e5;
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            -webkit-tap-highlight-color: transparent;
            background-image: linear-gradient(to bottom right, #0f0f0f 0%, #050505 100%);
            min-height: 100vh;
        }

        .glass-panel {
            background: rgba(30, 30, 35, 0.4);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.07);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        .header-transparent {
            background: transparent;
        }
        
        /* Toggle Switch Styles */
        .toggle-btn.active {
            background-color: #2563eb; /* blue-600 */
            color: white;
            box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.3);
        }
        .toggle-btn {
            background-color: rgba(255,255,255,0.05);
            color: #9ca3af;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;
        
        // --- DATA ---
        // Stored in Imperial (lbs, mph) for base calculation
        const CAR_DB = [
            { id: 'm1', series: 'M1', model: 'M1', generation: 'E26', years: '1978–1981', engine: '3.5L I6 (M88)', hp: 273, torque: '243 lb-ft', weight: 2866, zeroSixty: '5.6s', topSpeed: '162 mph', significance: 'The first bespoke BMW M car; a mid-engine supercar.' },
            { id: '1m', series: '1M', model: '1 Series M Coupe', generation: 'E82', years: '2011–2012', engine: '3.0L TT I6 (N54)', hp: 335, torque: '332 lb-ft', weight: 3296, zeroSixty: '4.7s', topSpeed: '155 mph', significance: 'Widened fenders, manual only, cult classic.' },
            { id: 'm2f87', series: 'M2', model: 'M2 Competition', generation: 'F87', years: '2018–2021', engine: '3.0L TT I6 (S55)', hp: 405, torque: '406 lb-ft', weight: 3600, zeroSixty: '4.0s', topSpeed: '174 mph', significance: 'Spiritual successor to the E30 M3.' },
            { id: 'm2g87', series: 'M2', model: 'M2', generation: 'G87', years: '2023–Present', engine: '3.0L TT I6 (S58)', hp: 453, torque: '406 lb-ft', weight: 3814, zeroSixty: '3.9s', topSpeed: '177 mph', significance: 'Last pure combustion M car with a manual.' },
            { id: 'm3e30', series: 'M3', model: 'M3', generation: 'E30', years: '1986–1991', engine: '2.3L I4 (S14)', hp: 192, torque: '170 lb-ft', weight: 2645, zeroSixty: '6.7s', topSpeed: '146 mph', significance: 'The homologation legend.' },
            { id: 'm3e36', series: 'M3', model: 'M3 (Euro)', generation: 'E36', years: '1992–1999', engine: '3.2L I6 (S50)', hp: 316, torque: '258 lb-ft', weight: 3219, zeroSixty: '5.5s', topSpeed: '155 mph', significance: 'Introduced the modern inline-6 M philosophy.' },
            { id: 'm3e46', series: 'M3', model: 'M3', generation: 'E46', years: '2000–2006', engine: '3.2L I6 (S54)', hp: 333, torque: '262 lb-ft', weight: 3415, zeroSixty: '4.8s', topSpeed: '155 mph', significance: 'The definitive M car. High-revving NA I6.' },
            { id: 'm3e92', series: 'M3', model: 'M3', generation: 'E92', years: '2007–2013', engine: '4.0L V8 (S65)', hp: 414, torque: '295 lb-ft', weight: 3649, zeroSixty: '4.6s', topSpeed: '155 mph', significance: 'The only V8 M3.' },
            { id: 'm3f80', series: 'M3', model: 'M3', generation: 'F80', years: '2014–2018', engine: '3.0L TT I6 (S55)', hp: 425, torque: '406 lb-ft', weight: 3540, zeroSixty: '3.9s', topSpeed: '155 mph', significance: 'Return to I6, but turbocharged.' },
            { id: 'm3g80', series: 'M3', model: 'M3 Comp xDrive', generation: 'G80', years: '2021–Present', engine: '3.0L TT I6 (S58)', hp: 503, torque: '479 lb-ft', weight: 3990, zeroSixty: '3.4s', topSpeed: '180 mph', significance: 'First M3 with xDrive AWD.' },
            { id: 'm4f82', series: 'M4', model: 'M4', generation: 'F82', years: '2014–2020', engine: '3.0L TT I6 (S55)', hp: 425, torque: '406 lb-ft', weight: 3585, zeroSixty: '3.9s', topSpeed: '155 mph', significance: 'The Coupe split from the M3 nameplate.' },
            { id: 'm4g82', series: 'M4', model: 'M4 Comp xDrive', generation: 'G82', years: '2021–Present', engine: '3.0L TT I6 (S58)', hp: 503, torque: '479 lb-ft', weight: 3979, zeroSixty: '3.4s', topSpeed: '180 mph', significance: 'Benchmark performance coupe.' },
            { id: 'm5e28', series: 'M5', model: 'M5', generation: 'E28', years: '1985–1988', engine: '3.5L I6 (S38)', hp: 282, torque: '251 lb-ft', weight: 3417, zeroSixty: '6.2s', topSpeed: '152 mph', significance: 'The original super sedan.' },
            { id: 'm5e34', series: 'M5', model: 'M5', generation: 'E34', years: '1989–1995', engine: '3.8L I6 (S38)', hp: 340, torque: '295 lb-ft', weight: 3803, zeroSixty: '5.9s', topSpeed: '155 mph', significance: 'Last hand-built M5.' },
            { id: 'm5e39', series: 'M5', model: 'M5', generation: 'E39', years: '1998–2003', engine: '4.9L V8 (S62)', hp: 394, torque: '369 lb-ft', weight: 3957, zeroSixty: '4.8s', topSpeed: '155 mph', significance: 'Perfectly balanced, iconic sports sedan.' },
            { id: 'm5e60', series: 'M5', model: 'M5', generation: 'E60', years: '2005–2010', engine: '5.0L V10 (S85)', hp: 500, torque: '384 lb-ft', weight: 4090, zeroSixty: '4.5s', topSpeed: '190 mph', significance: 'F1 V10 technology for the road.' },
            { id: 'm5f10', series: 'M5', model: 'M5 Comp', generation: 'F10', years: '2011–2016', engine: '4.4L TT V8 (S63)', hp: 575, torque: '502 lb-ft', weight: 4387, zeroSixty: '4.1s', topSpeed: '190 mph', significance: 'Introduction of turbocharging to M5.' },
            { id: 'm5f90', series: 'M5', model: 'M5 Comp', generation: 'F90', years: '2017–2023', engine: '4.4L TT V8 (S63)', hp: 617, torque: '553 lb-ft', weight: 4233, zeroSixty: '3.1s', topSpeed: '190 mph', significance: 'First M5 with AWD.' },
            { id: 'm5g90', series: 'M5', model: 'M5', generation: 'G90', years: '2025–Present', engine: '4.4L V8 Hybrid', hp: 717, torque: '738 lb-ft', weight: 5390, zeroSixty: '3.4s', topSpeed: '190 mph', significance: 'First Plug-in Hybrid M5.' },
            { id: 'm6e24', series: 'M6', model: 'M635CSi', generation: 'E24', years: '1983–1989', engine: '3.5L I6 (M88)', hp: 282, torque: '251 lb-ft', weight: 3307, zeroSixty: '6.4s', topSpeed: '158 mph', significance: 'Sharknose grand tourer with M1 engine.' },
            { id: 'm6e63', series: 'M6', model: 'M6', generation: 'E63', years: '2005–2010', engine: '5.0L V10 (S85)', hp: 500, torque: '384 lb-ft', weight: 3909, zeroSixty: '4.4s', topSpeed: '190 mph', significance: 'V10 Grand Tourer.' },
            { id: 'm8g15', series: 'M8', model: 'M8 Comp', generation: 'G15', years: '2019–Present', engine: '4.4L TT V8 (S63)', hp: 617, torque: '553 lb-ft', weight: 4295, zeroSixty: '3.0s', topSpeed: '190 mph', significance: 'Fastest accelerating production BMW.' },
            { id: 'z3m', series: 'Z', model: 'Z3 M Coupe', generation: 'E36/8', years: '1997–2002', engine: '3.2L I6 (S54)', hp: 315, torque: '251 lb-ft', weight: 3131, zeroSixty: '5.2s', topSpeed: '155 mph', significance: 'The legendary Clown Shoe.' },
            { id: 'z4m', series: 'Z', model: 'Z4 M Coupe', generation: 'E86', years: '2006–2008', engine: '3.2L I6 (S54)', hp: 330, torque: '262 lb-ft', weight: 3230, zeroSixty: '4.8s', topSpeed: '155 mph', significance: 'Last use of the S54 engine.' },
            { id: 'x5mf95', series: 'X', model: 'X5 M Comp', generation: 'F95', years: '2020–Present', engine: '4.4L TT V8 (S63)', hp: 617, torque: '553 lb-ft', weight: 5425, zeroSixty: '3.7s', topSpeed: '177 mph', significance: 'Supercar performance in an SUV.' },
            { id: 'xmg09', series: 'XM', model: 'XM', generation: 'G09', years: '2023–Present', engine: '4.4L V8 Hybrid', hp: 644, torque: '590 lb-ft', weight: 6062, zeroSixty: '4.1s', topSpeed: '168 mph', significance: 'First standalone M car since M1.' }
        ];

        const SERIES_LIST = ['All', ...new Set(CAR_DB.map(car => car.series))];

        const MenuIcon = () => (
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="5" r="2" fill="#E5E5E5" />
                <circle cx="12" cy="12" r="2" fill="#E5E5E5" />
                <circle cx="12" cy="19" r="2" fill="#E5E5E5" />
            </svg>
        );

        function App() {
            const [selectedCar, setSelectedCar] = useState(null);
            const [searchTerm, setSearchTerm] = useState("");
            const [menuOpen, setMenuOpen] = useState(false);
            const [viewMode, setViewMode] = useState("grid");
            const [activeSeries, setActiveSeries] = useState('All');
            const [compareMode, setCompareMode] = useState(false);
            const [compareList, setCompareList] = useState([]);
            const [showComparison, setShowComparison] = useState(false);
            
            // --- UNIT SETTINGS ---
            const [unitSpeed, setUnitSpeed] = useState('mph'); // 'mph' or 'km/h'
            const [unitWeight, setUnitWeight] = useState('lbs'); // 'lbs' or 'kg'

            // --- HELPER FUNCTIONS ---
            
            // Converts numeric weight based on current unit settings
            const getFormattedWeight = (weightLbs) => {
                if (unitWeight === 'kg') {
                    const kg = Math.round(weightLbs * 0.453592);
                    return `${kg} kg`;
                }
                return `${weightLbs} lbs`;
            };

            // Converts Top Speed string ("155 mph")
            const getFormattedSpeed = (speedStr) => {
                const val = parseInt(speedStr.replace(/[^0-9]/g, ''));
                if (isNaN(val)) return speedStr;
                
                if (unitSpeed === 'km/h') {
                    const kmh = Math.round(val * 1.60934);
                    return `${kmh} km/h`;
                }
                return `${val} mph`;
            };

            // Calculates Power-to-Weight Ratio based on current units
            const getPWR = (hp, weightLbs) => {
                if (unitWeight === 'kg') {
                    const weightKg = weightLbs * 0.453592;
                    return (hp / weightKg).toFixed(4);
                }
                return (hp / weightLbs).toFixed(4);
            };

            const getPWRLabel = () => unitWeight === 'kg' ? 'hp/kg' : 'hp/lb';

            const filteredCars = useMemo(() => {
                let data = CAR_DB;
                if (activeSeries !== 'All') data = data.filter(car => car.series === activeSeries);
                if (searchTerm) {
                    data = data.filter(car => 
                        car.model.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        car.generation.toLowerCase().includes(searchTerm.toLowerCase())
                    );
                }
                return data;
            }, [searchTerm, activeSeries]);

            const handleCarClick = (car) => {
                if (compareMode) {
                    setCompareList(prev => prev.find(c => c.id === car.id) ? prev.filter(c => c.id !== car.id) : (prev.length < 3 ? [...prev, car] : prev));
                } else {
                    setSelectedCar(car);
                }
            };

            const activateCompareMode = () => { setCompareMode(true); setMenuOpen(false); setSelectedCar(null); };
            const exitCompareMode = () => { setCompareMode(false); setCompareList([]); setShowComparison(false); };
            
            // CHANGED: Clears search term when a series is selected
            const handleSeriesSelect = (series) => { 
                setActiveSeries(series); 
                setSearchTerm(""); 
                setMenuOpen(false); 
                window.scrollTo({ top: 0, behavior: 'smooth' }); 
            };

            useEffect(() => { document.body.style.overflow = (selectedCar || showComparison || menuOpen) ? 'hidden' : 'auto'; }, [selectedCar, showComparison, menuOpen]);

            return (
                <div className="min-h-screen pb-20 relative selection:bg-blue-900 selection:text-white font-sans">
                    
                    {/* --- HEADER --- */}
                    <header className="fixed top-0 left-0 right-0 z-40 header-transparent px-4 sm:px-6 h-20 flex items-center justify-between">
                        <div className="h-10 md:h-14 relative flex items-center w-auto">
                             <img src="https://i.ibb.co/bMf9C53M/20251129-203223.png" alt="BMW M Logo" className="h-full w-auto object-contain drop-shadow-lg" />
                        </div>
                        <button onClick={() => setMenuOpen(true)} className="p-2 hover:bg-white/5 rounded-full transition-colors active:scale-90 duration-200">
                            <MenuIcon />
                        </button>
                    </header>

                    {/* --- SEARCH BAR --- */}
                    <div className="pt-24 pb-6 px-6 sticky top-0 z-30 pointer-events-none">
                        <div className="relative max-w-7xl mx-auto pointer-events-auto">
                            <input 
                                type="text"
                                placeholder={activeSeries === 'All' ? "Search the Registry..." : `Search ${activeSeries} Series...`}
                                value={searchTerm}
                                onChange={e => setSearchTerm(e.target.value)}
                                className="block w-full pl-6 pr-12 py-4 bg-[#111]/80 backdrop-blur-xl border border-white/10 rounded-2xl text-gray-100 placeholder-gray-500 focus:outline-none focus:border-blue-500/50 focus:ring-1 focus:ring-blue-500/50 transition-all shadow-xl font-medium text-lg"
                            />
                             <div className="absolute inset-y-0 right-4 flex items-center pointer-events-none text-gray-500">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-search"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                            </div>
                        </div>
                    </div>

                    {/* --- MAIN CONTENT --- */}
                    <main className="px-6 max-w-7xl mx-auto">
                        <div className="flex items-end justify-between mb-8">
                             <div>
                                <h1 className="text-3xl font-black text-white uppercase tracking-tighter">{activeSeries} Series</h1>
                                <p className="text-sm text-gray-500 font-medium">{filteredCars.length} Vehicles Indexed</p>
                             </div>
                        </div>

                        {viewMode === 'grid' ? (
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 animate-fade-in">
                                {filteredCars.map(car => (
                                    <div key={car.id} onClick={() => handleCarClick(car)}
                                        className={`glass-panel rounded-3xl p-6 relative overflow-hidden group cursor-pointer transition-all duration-500 hover:-translate-y-1 hover:shadow-2xl
                                            ${compareMode && compareList.find(c => c.id === car.id) ? 'border-blue-500/80 ring-2 ring-blue-500/50' : 'hover:border-white/30'}`}>
                                        <div className="relative z-10 flex flex-col h-full justify-between">
                                            <div>
                                                <div className="flex justify-between items-start mb-4">
                                                    <span className="px-3 py-1 bg-white/5 rounded-full text-xs font-bold text-blue-400 uppercase tracking-wider border border-white/5">{car.series}</span>
                                                    <span className="font-mono text-sm text-gray-400">{car.years.split('–')[0]}</span>
                                                </div>
                                                <h3 className="text-4xl font-black text-white leading-none mb-2">{car.generation}</h3>
                                                <p className="text-lg text-gray-300 font-medium truncate">{car.model}</p>
                                            </div>
                                            <div className="grid grid-cols-3 gap-4 pt-6 border-t border-white/5">
                                                <div>
                                                    <p className="text-[10px] text-gray-500 uppercase font-bold">Power</p>
                                                    <p className="text-sm font-bold text-white">{car.hp} <span className="text-[10px] font-normal text-gray-500">HP</span></p>
                                                </div>
                                                <div>
                                                    <p className="text-[10px] text-gray-500 uppercase font-bold">Weight</p>
                                                    <p className="text-sm font-bold text-white">{getFormattedWeight(car.weight).split(' ')[0]} <span className="text-[10px] font-normal text-gray-500">{getFormattedWeight(car.weight).split(' ')[1]}</span></p>
                                                </div>
                                                <div className="text-right">
                                                    <p className="text-[10px] text-blue-500 uppercase font-bold">{getPWRLabel().toUpperCase()}</p>
                                                    <p className="text-sm font-black text-blue-400">{getPWR(car.hp, car.weight)}</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div className="absolute -bottom-6 -right-6 text-[120px] font-black text-white/[0.03] leading-none select-none pointer-events-none group-hover:text-white/[0.07] transition-colors duration-500">///M</div>
                                        {compareMode && <div className={`absolute top-5 right-5 w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all ${compareList.find(c => c.id === car.id) ? 'bg-blue-500 border-blue-500 scale-110' : 'border-gray-600 bg-black/50'}`}>{compareList.find(c => c.id === car.id) && <svg className="w-3 h-3 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={4}><path strokeLinecap="round" strokeLinejoin="round" d="M5 13l4 4L19 7" /></svg>}</div>}
                                    </div>
                                ))}
                            </div>
                        ) : (
                            <div className="space-y-4 animate-fade-in">
                                {filteredCars.map(car => (
                                    <div key={car.id} onClick={() => handleCarClick(car)}
                                        className={`glass-panel rounded-2xl p-5 flex items-center justify-between cursor-pointer transition-all duration-300 group hover:bg-white/5
                                            ${compareMode && compareList.find(c => c.id === car.id) ? 'border-blue-500/80 bg-blue-900/10' : 'hover:border-white/30'}`}>
                                        <div className="flex items-center gap-6">
                                            <div className="text-3xl font-black text-gray-600 group-hover:text-white transition-colors w-24 text-center">{car.generation}</div>
                                            <div>
                                                <h3 className="text-xl font-bold text-white mb-1 group-hover:text-blue-400 transition-colors">{car.model}</h3>
                                                <p className="text-sm text-gray-500 font-medium flex gap-4">
                                                    <span>{car.years}</span> <span className="text-blue-500 font-bold">{getFormattedSpeed(car.topSpeed)}</span>
                                                </p>
                                            </div>
                                        </div>
                                        <div className="hidden md:flex items-center gap-6 text-right">
                                            <div><p className="text-xs text-gray-500 font-bold">HP</p><p className="text-lg font-bold text-white">{car.hp}</p></div>
                                            <div><p className="text-xs text-gray-500 font-bold">Weight</p><p className="text-lg font-bold text-white">{getFormattedWeight(car.weight)}</p></div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </main>

                    {/* --- SIDE MENU --- */}
                    <div className={`fixed inset-0 z-50 transition-all duration-500 ${menuOpen ? 'pointer-events-auto' : 'pointer-events-none delay-500'}`}>
                        <div className={`absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity duration-500 ${menuOpen ? 'opacity-100' : 'opacity-0'}`} onClick={() => setMenuOpen(false)}/>
                        <div className={`absolute right-0 top-0 w-80 bg-[#0a0a0a] h-full shadow-2xl border-l border-white/10 flex flex-col transform transition-transform duration-500 cubic-bezier(0.2, 0.8, 0.2, 1) ${menuOpen ? 'translate-x-0' : 'translate-x-full'}`}>
                            <div className="p-8 flex items-center justify-between">
                                <h2 className="text-2xl font-black text-white tracking-tighter italic">/// CONTROLS</h2>
                                <button onClick={() => setMenuOpen(false)} className="text-gray-500 hover:text-white transition-colors p-2 hover:bg-white/10 rounded-full"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
                            </div>
                            <div className="px-8 flex-1 overflow-y-auto space-y-10 pb-10">
                                
                                {/* UNITS SECTION */}
                                <section>
                                    <h3 className="text-xs font-bold text-gray-500 uppercase tracking-widest mb-4">Unit Preferences</h3>
                                    
                                    {/* Speed Toggle */}
                                    <div className="mb-4">
                                        <div className="flex bg-white/5 p-1 rounded-xl">
                                            <button onClick={() => setUnitSpeed('mph')} className={`flex-1 py-3 text-xs font-bold rounded-lg transition-all ${unitSpeed === 'mph' ? 'toggle-btn active' : 'toggle-btn'}`}>MPH</button>
                                            <button onClick={() => setUnitSpeed('km/h')} className={`flex-1 py-3 text-xs font-bold rounded-lg transition-all ${unitSpeed === 'km/h' ? 'toggle-btn active' : 'toggle-btn'}`}>KM/H</button>
                                        </div>
                                    </div>

                                    {/* Weight Toggle */}
                                    <div>
                                        <div className="flex bg-white/5 p-1 rounded-xl">
                                            <button onClick={() => setUnitWeight('lbs')} className={`flex-1 py-3 text-xs font-bold rounded-lg transition-all ${unitWeight === 'lbs' ? 'toggle-btn active' : 'toggle-btn'}`}>LBS</button>
                                            <button onClick={() => setUnitWeight('kg')} className={`flex-1 py-3 text-xs font-bold rounded-lg transition-all ${unitWeight === 'kg' ? 'toggle-btn active' : 'toggle-btn'}`}>KG</button>
                                        </div>
                                    </div>
                                </section>

                                <section>
                                    <h3 className="text-xs font-bold text-gray-500 uppercase tracking-widest mb-4">View Layout</h3>
                                    <div className="flex bg-white/5 p-1 rounded-xl">
                                        <button onClick={() => setViewMode('grid')} className={`flex-1 py-3 text-xs font-bold rounded-lg transition-all ${viewMode === 'grid' ? 'bg-blue-600 text-white shadow-lg' : 'text-gray-500 hover:text-white'}`}>GRID</button>
                                        <button onClick={() => setViewMode('list')} className={`flex-1 py-3 text-xs font-bold rounded-lg transition-all ${viewMode === 'list' ? 'bg-blue-600 text-white shadow-lg' : 'text-gray-500 hover:text-white'}`}>LIST</button>
                                    </div>
                                </section>
                                <section>
                                    <h3 className="text-xs font-bold text-gray-500 uppercase tracking-widest mb-4">Tools</h3>
                                    <button onClick={activateCompareMode} className="w-full py-4 bg-gradient-to-r from-blue-600/20 to-transparent border border-blue-500/30 rounded-xl text-blue-400 font-bold hover:border-blue-400 transition-all flex items-center justify-center gap-3 hover:from-blue-600/30 hover:text-white group">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="group-hover:scale-110 transition-transform"><path d="M16 3h5v5"/><path d="M21 3l-7 7"/><path d="M21 14v7h-7"/><path d="M21 21l-7-7"/><path d="M3 10v11h11"/><path d="M3 21l7-7"/></svg>
                                        Start Comparison
                                    </button>
                                </section>
                                <section>
                                    <h3 className="text-xs font-bold text-gray-500 uppercase tracking-widest mb-4">Series Registry</h3>
                                    <div className="space-y-1">
                                        {SERIES_LIST.map(series => (
                                            <button key={series} onClick={() => handleSeriesSelect(series)}
                                                className={`w-full text-left px-4 py-3 rounded-xl text-sm font-bold transition-all flex items-center justify-between group ${activeSeries === series ? 'bg-white text-black' : 'hover:bg-white/10 text-gray-400 hover:text-white'}`}>
                                                {series === 'All' ? 'Complete Registry' : `BMW ${series} Series`}
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className={`transition-transform ${activeSeries === series ? 'text-blue-600 rotate-0' : 'text-gray-600 -rotate-45 group-hover:text-white group-hover:rotate-0'}`}><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                                            </button>
                                        ))}
                                    </div>
                                </section>
                            </div>
                        </div>
                    </div>

                    {/* --- COMPARE BOTTOM BAR --- */}
                    {compareMode && !showComparison && (
                        <div className="fixed bottom-0 left-0 right-0 z-50 glass-panel border-t border-white/10 p-4 animate-slide-up">
                            <div className="max-w-4xl mx-auto flex items-center justify-between">
                                <div><p className="text-sm text-blue-400 font-bold uppercase tracking-wider">Comparison Mode</p><p className="text-xs text-gray-400 font-medium">{compareList.length} / 3 Selected</p></div>
                                <div className="flex gap-3">
                                    <button onClick={exitCompareMode} className="px-6 py-3 rounded-xl text-xs font-bold text-gray-300 hover:bg-white/10 transition-colors">CANCEL</button>
                                    <button onClick={() => setShowComparison(true)} disabled={compareList.length < 2} className={`px-8 py-3 rounded-xl text-xs font-bold bg-blue-600 text-white hover:bg-blue-500 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-blue-600/30`}>VIEW COMPARISON</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* --- DETAILS MODAL --- */}
                    {selectedCar && (
                        <div className="fixed inset-0 z-50 flex items-end sm:items-center justify-center p-4 sm:p-8">
                            <div className="absolute inset-0 bg-black/80 backdrop-blur-xl transition-opacity" onClick={() => setSelectedCar(null)}/>
                            <div className="relative bg-[#0a0a0a] w-full max-w-3xl max-h-[90vh] overflow-y-auto rounded-[2rem] border border-white/10 shadow-2xl animate-slide-up scrollbar-hide ring-1 ring-white/5">
                                <div className="sticky top-0 right-0 p-6 flex justify-end z-20 pointer-events-none bg-gradient-to-b from-[#0a0a0a] via-[#0a0a0a]/80 to-transparent">
                                    <button onClick={() => setSelectedCar(null)} className="pointer-events-auto bg-white/10 backdrop-blur-md border border-white/10 p-3 rounded-full text-white hover:bg-white/20 transition-colors hover:rotate-90 duration-300"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
                                </div>
                                <div className="px-8 sm:px-12 pb-12">
                                    <div className="mb-10">
                                        <div className="flex items-center gap-3 mb-4"><span className="px-4 py-1.5 bg-blue-600/20 text-blue-400 rounded-full text-xs font-bold uppercase tracking-wider border border-blue-500/30">{selectedCar.series} Series</span><span className="text-gray-400 font-medium">{selectedCar.years}</span></div>
                                        <h2 className="text-5xl sm:text-7xl font-black text-white mb-2 tracking-tighter leading-none">{selectedCar.model}</h2>
                                        <p className="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-gray-400 to-gray-600">{selectedCar.generation}</p>
                                    </div>
                                    <p className="text-lg text-gray-300 leading-relaxed mb-12 font-medium border-l-4 border-blue-500 pl-6 py-2">{selectedCar.significance}</p>
                                    
                                    <div className="grid grid-cols-2 gap-4 mb-8">
                                        <div className="bg-white/5 p-5 rounded-2xl border border-white/5"><p className="text-xs uppercase text-gray-500 font-bold mb-2 tracking-wider">Power</p><p className="text-3xl font-black text-white break-words">{selectedCar.hp} <span className="text-sm font-bold text-gray-500">HP</span></p></div>
                                        <div className="bg-white/5 p-5 rounded-2xl border border-white/5"><p className="text-xs uppercase text-gray-500 font-bold mb-2 tracking-wider">Weight</p><p className="text-3xl font-black text-white break-words">{getFormattedWeight(selectedCar.weight)}</p></div>
                                        <div className="bg-white/5 p-5 rounded-2xl border border-white/5"><p className="text-xs uppercase text-gray-500 font-bold mb-2 tracking-wider">0-60 MPH</p><p className="text-3xl font-black text-white break-words">{selectedCar.zeroSixty}</p></div>
                                        <div className="bg-white/5 p-5 rounded-2xl border border-white/5"><p className="text-xs uppercase text-gray-500 font-bold mb-2 tracking-wider">Top Speed</p><p className="text-3xl font-black text-white break-words">{getFormattedSpeed(selectedCar.topSpeed)}</p></div>
                                        
                                        <div className="bg-white/5 p-5 rounded-2xl border border-white/5 col-span-2">
                                            <p className="text-xs uppercase text-gray-500 font-bold mb-2 tracking-wider">Torque</p>
                                            <p className="text-3xl font-black text-white break-words">{selectedCar.torque}</p>
                                        </div>
                                        
                                        <div className="bg-gradient-to-br from-blue-600/30 to-blue-900/10 p-5 rounded-2xl border border-blue-500/30 col-span-2"><p className="text-xs uppercase text-blue-300 font-bold mb-2 tracking-wider">Power-to-Weight</p><p className="text-4xl font-black text-blue-100 break-words">{getPWR(selectedCar.hp, selectedCar.weight)} <span className="text-lg font-bold text-blue-300">{getPWRLabel()}</span></p></div>
                                    </div>
                                    <div className="bg-[#111] p-6 rounded-2xl border border-white/10 flex flex-col sm:flex-row items-start sm:items-center gap-4"><div className="p-3 bg-white/5 rounded-xl text-gray-400"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><path d="M6.5 17H20"/><path d="M6.5 17a2.5 2.5 0 1 1 0-5C8 12 9 13 9 14.5s1 2.5 2.5 2.5h8.5"/><path d="M6.5 17a2.5 2.5 0 1 0 0 5c1.5 0 2.5-1 2.5-2.5"/></svg></div><div><p className="text-xs uppercase text-gray-500 font-bold mb-1 tracking-wider">Engine Powertrain</p><p className="text-xl font-mono font-bold text-white">{selectedCar.engine}</p></div></div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* --- COMPARISON MODAL --- */}
                    {showComparison && (
                        <div className="fixed inset-0 z-50 bg-[#0a0a0a] overflow-y-auto animate-fade-in">
                            <div className="min-h-screen p-4 sm:p-8">
                                <div className="max-w-7xl mx-auto">
                                    <div className="flex items-center justify-between mb-12 sticky top-0 bg-[#0a0a0a]/90 backdrop-blur-md py-6 z-10">
                                        <div><h2 className="text-4xl font-black text-white tracking-tighter italic">SPEC BATTLE</h2><p className="text-sm text-gray-500 font-bold uppercase tracking-wider">Direct Comparison</p></div>
                                        <button onClick={exitCompareMode} className="bg-white/10 hover:bg-white/20 text-white px-6 py-3 rounded-xl text-sm font-bold transition-colors flex items-center gap-2"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg> CLOSE VIEW</button>
                                    </div>
                                    <div className={`grid grid-cols-1 gap-8 ${compareList.length === 2 ? 'md:grid-cols-2' : 'md:grid-cols-3'}`}>
                                        {compareList.map((car, idx) => (
                                            <div key={idx} className="glass-panel rounded-[2.5rem] p-8 relative flex flex-col">
                                                <div className="mb-10 relative z-10"><p className="text-sm text-blue-400 font-bold uppercase tracking-wider mb-2">{car.series} Series • {car.years}</p><h3 className="text-4xl font-black text-white leading-none mb-2">{car.model}</h3><p className="text-2xl font-bold text-gray-500">{car.generation}</p></div>
                                                <div className="space-y-4 flex-1 relative z-10">
                                                     <div className="bg-gradient-to-r from-blue-600/20 to-blue-900/10 border border-blue-500/30 p-5 rounded-2xl mb-6"><p className="text-xs text-blue-300 uppercase font-bold tracking-wider mb-1">Power-to-Weight</p><p className="text-4xl font-black text-white break-words">{getPWR(car.hp, car.weight)} <span className="text-lg font-bold text-blue-300">{getPWRLabel()}</span></p></div>
                                                    <div className="grid grid-cols-2 gap-4">
                                                        <div className="bg-white/5 p-4 rounded-2xl"><p className="text-[10px] text-gray-500 uppercase font-bold mb-1">Horsepower</p><p className="text-2xl font-black text-white break-words">{car.hp}</p></div>
                                                        <div className="bg-white/5 p-4 rounded-2xl"><p className="text-[10px] text-gray-500 uppercase font-bold mb-1">Weight (lbs)</p><p className="text-2xl font-black text-white break-words">{getFormattedWeight(car.weight)}</p></div>
                                                    </div>
                                                    <div className="bg-white/5 p-5 rounded-2xl space-y-4 divide-y divide-white/5">
                                                        <div className="flex justify-between items-center pt-2"><span className="text-xs text-gray-500 font-bold uppercase">0-60 mph</span><span className="text-xl font-mono font-bold text-white break-words">{car.zeroSixty}</span></div>
                                                        <div className="flex justify-between items-center pt-4"><span className="text-xs text-gray-500 font-bold uppercase">Top Speed</span><span className="text-xl font-mono font-bold text-white break-words">{getFormattedSpeed(car.topSpeed)}</span></div>
                                                        <div className="flex justify-between items-center pt-4"><span className="text-xs text-gray-500 font-bold uppercase">Torque</span><span className="text-xl font-mono font-bold text-white break-words">{car.torque}</span></div>
                                                    </div>
                                                     <div className="mt-auto pt-4"><p className="text-[10px] text-gray-500 uppercase font-bold mb-2">Engine</p><p className="font-mono text-sm text-gray-300 bg-black/30 p-3 rounded-xl border border-white/5">{car.engine}</p></div>
                                                </div>
                                                <div className="absolute bottom-0 right-0 text-[180px] font-black text-white/[0.02] leading-none select-none pointer-events-none overflow-hidden rounded-[2.5rem]">{car.generation.substring(0,1)}</div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>